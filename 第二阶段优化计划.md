# Visorq 第二阶段优化计划

## 项目概述

基于第一阶段的成功部署，第二阶段将重点优化用户体验、数据集成和功能深度，使各模块之间更加紧密结合，提供更流畅的工作流程。

## 优化目标

### 1. 项目看板增强 🎯

**目标**: 实现拖拽式项目状态管理

**功能点**:
- ✅ 看板视图展示项目（Planning → Active → On-Hold → Completed）
- ✅ 支持拖拽卡片在不同状态列之间移动
- ✅ 实时更新项目状态
- ✅ 卡片显示关键信息（优先级、资源、进度）
- ✅ 状态变更历史记录

**技术实现**:
- 使用 `@dnd-kit/core` 实现拖拽功能
- 优化 KanbanBoard 组件
- 添加状态变更动画效果

---

### 2. 项目模板与 CRUD 深度集成 📋

**目标**: 一键从模板创建项目，增强项目详情页

#### 2.1 模板一键创建
- ✅ 在"新建项目"时显示可用模板列表
- ✅ 选择模板后自动填充项目信息
- ✅ 支持模板预览
- ✅ 允许在模板基础上修改

#### 2.2 项目详情页重构
**新增子页面**: `/projects/:id/details`

**页面布局**:
```
┌─────────────────────────────────────────┐
│  项目基本信息卡片                          │
│  - 名称、描述、优先级、状态                │
│  - 开始/结束日期、负责人                   │
│  - 快速操作按钮（编辑、删除、导出）         │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  项目甘特图                               │
│  - 显示项目时间线                         │
│  - 关键里程碑标记                         │
│  - 支持拖拽调整进度                       │
│  - 依赖关系可视化                         │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  资源分配 | 成本分析 | 风险评估            │
│  （标签页切换）                           │
└─────────────────────────────────────────┘
```

**里程碑功能**:
- 添加/编辑/删除里程碑
- 里程碑进度跟踪
- 里程碑完成度可视化
- 逾期里程碑预警

---

### 3. 资源池页面全面优化 👥

#### 3.1 资源池与项目集成
**改进点**:
- ✅ 项目进度快照卡片添加"View Details"按钮
- ✅ 点击跳转到对应项目详情页（`/projects/:id/details`）
- ✅ 显示项目当前状态和进度百分比
- ✅ 快速查看项目资源占用情况

#### 3.2 资源热力图优化
**数据集成**:
- ✅ 热力图数据来源于实际项目分配
- ✅ 颜色深度反映资源利用率
- ✅ 显示每个成员的具体项目分配
- ✅ 支持按部门/技能筛选

#### 3.3 资源详细信息管理
**新增字段**:
```typescript
interface TeamMember {
  id: string;
  name: string;
  gender: '男' | '女' | '其他';
  department: string;
  position: string; // 职称
  skills: Skill[];
  email?: string;
  phone?: string;
  joinDate: string;
  availability: number; // 每周可用小时
  hourlyRate?: number; // 时薪（用于成本计算）
  certifications?: string[]; // 资质证书
}
```

**功能实现**:
- ✅ 资源详情模态框
- ✅ 完整的个人信息表单
- ✅ 技能标签管理
- ✅ 历史项目参与记录
- ✅ 绩效评分（可选）

#### 3.4 容量规划与利用率结合
**优化方案**:
```
┌─────────────────────────────────────────┐
│  容量规划总览                             │
│  ┌─────────┬─────────┬─────────┐        │
│  │ 总容量  │ 已分配  │ 剩余容量 │        │
│  │ 1000h   │ 750h    │ 250h    │        │
│  └─────────┴─────────┴─────────┘        │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  部门/资源利用率矩阵                      │
│  ┌──────┬────┬────┬────┬────┐          │
│  │部门  │W1  │W2  │W3  │W4  │          │
│  ├──────┼────┼────┼────┼────┤          │
│  │开发  │85% │92% │78% │65% │          │
│  │设计  │70% │75% │80% │85% │          │
│  │测试  │95% │88% │90% │92% │ ⚠️       │
│  └──────┴────┴────┴────┴────┘          │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  资源分配建议                             │
│  • 测试部门本月超负荷，建议调配           │
│  • 设计部门下月有 15% 空闲容量            │
│  • 建议从开发部门临时调配 2 人支援测试     │
└─────────────────────────────────────────┘
```

**关键指标**:
- 实时利用率（当前周/月）
- 预测利用率（未来 4 周）
- 超负荷预警
- 闲置资源提示
- 智能分配建议

#### 3.5 资源时间线细化
**改进点**:
- ✅ 时间颗粒度从周级别细化到天级别
- ✅ 显示每个成员每天的项目分配
- ✅ 鼠标悬停显示详细信息（项目名称、分配时间、任务描述）
- ✅ 修复顶部信息遮盖问题（使用固定定位的 Tooltip）
- ✅ 支持缩放查看不同时间范围（日/周/月视图切换）

**时间线视图**:
```
成员      | 周一  | 周二  | 周三  | 周四  | 周五
─────────┼──────┼──────┼──────┼──────┼──────
张三      │ A(4h)│ A(6h)│ B(8h)│ B(8h)│ A(4h)
          │ B(4h)│ B(2h)│      │      │ C(4h)
─────────┼──────┼──────┼──────┼──────┼──────
李四      │ C(8h)│ C(8h)│ C(4h)│ D(8h)│ D(8h)
          │      │      │ D(4h)│      │      
```

#### 3.6 项目成本集成
**数据模型扩展**:
```typescript
interface Project {
  // ... 现有字段
  budget: number; // 预算
  actualCost: number; // 实际成本
  costBreakdown: {
    labor: number; // 人力成本
    equipment: number; // 设备成本
    materials: number; // 材料成本
    overhead: number; // 管理费用
    other: number; // 其他
  };
  costHistory: Array<{
    date: string;
    amount: number;
    category: string;
    description: string;
  }>;
}
```

**成本分析页面增强**:
- ✅ 项目成本登记表单
- ✅ 成本类别管理
- ✅ 实时成本追踪
- ✅ 预算 vs 实际对比图表
- ✅ 成本趋势分析
- ✅ 超支预警
- ✅ ROI 计算和可视化

**可视化图表**:
1. **成本构成饼图**: 展示各类成本占比
2. **成本趋势折线图**: 显示累计成本随时间变化
3. **预算执行率仪表盘**: 当前成本/预算百分比
4. **项目成本对比柱状图**: 多项目成本横向对比
5. **成本预测曲线**: 基于当前进度预测最终成本

---

## 实施计划

### Phase 1: 数据模型扩展（1-2天）
- [ ] 扩展 Project 类型定义（里程碑、成本）
- [ ] 扩展 TeamMember 类型定义（详细信息）
- [ ] 更新 Store 状态管理
- [ ] 数据迁移和初始化

### Phase 2: 项目模块优化（2-3天）
- [ ] 实现拖拽看板
- [ ] 模板一键创建功能
- [ ] 项目详情页重构
- [ ] 甘特图组件开发
- [ ] 里程碑管理功能

### Phase 3: 资源模块优化（3-4天）
- [ ] 资源详细信息表单
- [ ] 资源热力图数据集成
- [ ] 容量规划优化
- [ ] 时间线细化
- [ ] 项目跳转集成

### Phase 4: 成本模块集成（2-3天）
- [ ] 成本登记功能
- [ ] 成本分析图表
- [ ] 预算追踪
- [ ] ROI 计算

### Phase 5: 测试与优化（1-2天）
- [ ] 功能测试
- [ ] 性能优化
- [ ] UI/UX 调整
- [ ] 文档更新

**预计总工期**: 9-14 天

---

## 技术栈补充

### 新增依赖
```json
{
  "@dnd-kit/sortable": "^10.0.0", // 已有
  "gantt-task-react": "^0.3.9", // 甘特图
  "react-big-calendar": "^1.8.5", // 日历视图（可选）
  "d3": "^7.8.5" // 高级图表（可选）
}
```

---

## 成功指标

1. **用户体验**
   - 项目创建时间减少 50%（使用模板）
   - 资源分配效率提升 30%
   - 成本追踪准确度 > 95%

2. **功能完整性**
   - 所有模块数据互联互通
   - 无数据孤岛
   - 实时数据同步

3. **性能指标**
   - 页面加载时间 < 2s
   - 拖拽操作响应 < 100ms
   - 图表渲染时间 < 500ms

---

**文档版本**: 2.0  
**创建时间**: 2025-11-27  
**负责人**: Antigravity Team
