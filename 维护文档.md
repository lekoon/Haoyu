# CTPM Tool - 项目维护文档

本文档提供了 CTPM（Capacity & Team Planning Management）工具的全面指南，包括项目理解、维护和部署。

## 1. 项目概述

**CTPM Tool** 是一个用于资源规划和项目管理的单页应用程序（SPA）。

### 技术栈
- **框架**: React 18 (通过 Vite 构建)
- **语言**: TypeScript
- **样式**: TailwindCSS
- **路由**: React Router DOM (HashRouter)
- **状态管理**: Zustand
- **图标**: Lucide React
- **构建工具**: Vite
- **部署**: GitHub Pages

## 2. 本地开发入门

如果您需要在新机器上开发此项目，请按照以下步骤操作：

### 前置要求
- **Node.js**: 推荐版本 18 或更高
- **Git**: 用于版本控制
- **VS Code**: 推荐的代码编辑器

### 安装步骤
1.  **克隆仓库**:
    ```bash
    git clone https://github.com/lekoon/CTPMtool.git
    cd CTPMtool
    ```

2.  **安装依赖**:
    ```bash
    npm install
    ```

3.  **启动开发服务器**:
    ```bash
    npm run dev
    ```
    应用将在 `http://localhost:5173` 上运行。

## 3. 项目结构

```
CTPMtool/
├── dist/                # 生产构建输出（自动生成）
├── public/              # 静态资源（favicon 等）
├── src/
│   ├── components/      # 可复用的 UI 组件（Layout 等）
│   ├── pages/           # 页面组件（Dashboard, Projects 等）
│   ├── store/           # 全局状态管理（Zustand stores）
│   ├── types/           # TypeScript 类型定义
│   ├── utils/           # 辅助函数和算法
│   ├── App.tsx          # 主应用组件和路由配置
│   ├── main.tsx         # 入口文件
│   └── index.css        # 全局样式和 Tailwind 指令
├── package.json         # 依赖和脚本
├── vite.config.ts       # Vite 配置
└── tsconfig.json        # TypeScript 配置
```

## 4. 核心功能与实现

### 路由系统
- 在 `src/App.tsx` 中定义
- 使用 `react-router-dom` 的 **HashRouter**
- **为什么使用 HashRouter？**: 为了确保与 GitHub Pages 的兼容性。GitHub Pages 不支持客户端路由（pushState），因此使用 HashRouter。URL 将类似于 `/#/dashboard`
- **自动重定向**: `index.html` 中包含一个脚本，当访问不带 hash 的 URL 时，会自动重定向到 `/#/`

### 状态管理
- 使用 `zustand` 在 `src/store/useStore.ts` 中管理
- 数据持久化到 `localStorage`，因此刷新后数据不会丢失

### 样式系统
- 使用 TailwindCSS 工具类
- 全局样式在 `src/index.css` 中

## 5. 部署到 GitHub Pages

项目配置为使用 `gh-pages` 包自动部署到 GitHub Pages。

### 如何部署更新
1.  **修改代码**
2.  **提交并推送更改到 `main` 分支**:
    ```bash
    git add .
    git commit -m "描述您的更改"
    git push
    ```
3.  **运行部署脚本**:
    ```bash
    npm run deploy
    ```

### `npm run deploy` 做了什么？
1.  运行 `npm run build`（编译 TypeScript 并将应用构建到 `dist/` 目录）
2.  运行 `gh-pages -d dist`（将 `dist/` 文件夹推送到 GitHub 的 `gh-pages` 分支）

### 部署故障排除
- **空白页面**: 通常由 `vite.config.ts` 中的 `base` 路径配置错误引起
- **Hash URL**: 您会在 URL 中看到 `#`（例如 `.../CTPMtool/#/`）。这是正常的，是此部署方法的预期行为
- **重定向**: 访问 `https://lekoon.github.io/CTPMtool/` 会自动重定向到 `https://lekoon.github.io/CTPMtool/#/`

## 6. 常见任务

### 添加新页面
1.  在 `src/pages/NewPage.tsx` 中创建组件
2.  在 `src/App.tsx` 中添加路由:
    ```tsx
    <Route path="/new-page" element={
      <ProtectedRoute>
        <Layout>
          <NewPage />
        </Layout>
      </ProtectedRoute>
    } />
    ```
3.  在 `src/components/Layout.tsx` 中添加导航链接

### 修改数据模型
1.  在 `src/types/index.ts` 中更新类型定义
2.  在 `src/store/useStore.ts` 中更新 store 以处理新数据

### 修改样式
1.  对于全局样式，编辑 `src/index.css`
2.  对于组件样式，使用 TailwindCSS 工具类

## 7. 配置文件说明

### vite.config.ts
```typescript
export default defineConfig({
  base: './',  // 使用相对路径，适配 GitHub Pages
  plugins: [react(), tailwindcss()],
})
```
- `base: './'`: 对于 GitHub Pages 部署至关重要，使用相对路径确保资源正确加载

### package.json
- `"deploy": "gh-pages -d dist"`: 部署脚本

### index.html
- 包含自动重定向脚本，确保 HashRouter 正常工作

## 8. 在线访问

**线上地址**: [https://lekoon.github.io/CTPMtool/](https://lekoon.github.io/CTPMtool/)

**默认登录信息**:
- 用户名: `admin`
- 密码: `admin123`

## 9. 常见问题

### Q: 为什么 URL 中有 `#` 符号？
A: 这是因为使用了 HashRouter。这是在 GitHub Pages 等静态托管平台上部署 SPA 的标准做法。

### Q: 如何添加新用户？
A: 在登录后，进入"设置"页面，可以添加新用户。

### Q: 数据存储在哪里？
A: 数据存储在浏览器的 localStorage 中。这意味着数据是本地的，不会在不同设备或浏览器之间同步。

### Q: 如何备份数据？
A: 目前数据存储在 localStorage 中。您可以通过浏览器的开发者工具导出 localStorage 数据进行备份。

## 10. 技术支持

如果您在使用或维护项目时遇到问题，请：
1.  检查浏览器控制台是否有错误信息
2.  确保 Node.js 和 npm 版本符合要求
3.  尝试清除浏览器缓存和 localStorage
4.  重新安装依赖：`npm install`

---

**最后更新**: 2025-11-23
**版本**: 1.0.0
